<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="stylesheet" href="../.././src/pygments.css"></link><link rel="shortcut icon" href="../.././favicon.ico"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Server.Watchdog</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.Server.Watchdog";</script><script type="module" src="../.././search.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label>Documentation</h1><p class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span></p><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib4_docs"></input><input type="text" name="q" autocomplete="off"></input>&#32;
            <button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button><button>Google site search</button></form></header><nav class="internal_nav"><h3><a class="break_within" href="#top"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span></a></h3><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Init.html">Init</a></li><li><a href="../.././Init/Data/ByteArray.html">Init.Data.ByteArray</a></li><li><a href="../.././Init/System/IO.html">Init.System.IO</a></li><li><a href="../.././Lean/Data/FuzzyMatching.html">Lean.Data.FuzzyMatching</a></li><li><a href="../.././Lean/Data/Json.html">Lean.Data.Json</a></li><li><a href="../.././Lean/Data/Lsp.html">Lean.Data.Lsp</a></li><li><a href="../.././Lean/Data/RBMap.html">Lean.Data.RBMap</a></li><li><a href="../.././Lean/Server/References.html">Lean.Server.References</a></li><li><a href="../.././Lean/Server/Requests.html">Lean.Server.Requests</a></li><li><a href="../.././Lean/Server/Utils.html">Lean.Server.Utils</a></li><li><a href="../.././Lean/Util/Paths.html">Lean.Util.Paths</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Server.Watchdog" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.workerCfg"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">workerCfg</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.WorkerEvent"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">WorkerEvent</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.WorkerState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">WorkerState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.PendingRequestMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">PendingRequestMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.stdin"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">stdin</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.stdout"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">stdout</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.erasePendingRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">erasePendingRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorker.errorPendingRequests"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">errorPendingRequests</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.FileWorkerMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorkerMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ServerContext"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerContext</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ServerM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.updateFileWorkers"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">updateFileWorkers</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.findFileWorker?"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findFileWorker?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.findFileWorker!"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findFileWorker!</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.eraseFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">eraseFileWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.log"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">log</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleIleanInfoUpdate"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleIleanInfoUpdate</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleIleanInfoFinal"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleIleanInfoFinal</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.startFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">startFileWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.terminateFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">terminateFileWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleCrash"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCrash</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.tryWriteMessage"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">tryWriteMessage</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.findDefinitions"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findDefinitions</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleReference"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleReference</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleWorkspaceSymbol"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleWorkspaceSymbol</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleDidOpen"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidOpen</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleDidChange"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidChange</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleDidClose"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidClose</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleDidChangeWatchedFiles"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidChangeWatchedFiles</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleCancelRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCancelRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.forwardNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">forwardNotification</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.parseParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">parseParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.forwardRequestToWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">forwardRequestToWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.handleNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleNotification</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.shutdown"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">shutdown</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.ServerEvent"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerEvent</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.runClientTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">runClientTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.mainLoop"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">mainLoop</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.mkLeanServerCapabilities"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">mkLeanServerCapabilities</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.initAndRunWatchdogAux"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">initAndRunWatchdogAux</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.findWorkerPath"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findWorkerPath</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.loadReferences"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">loadReferences</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.initAndRunWatchdog"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">initAndRunWatchdog</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.Watchdog.watchdogMain"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">watchdogMain</span></a></div></nav><main>
<div class="mod_doc"><p>For general server architecture, see <code>README.md</code>. This module implements the watchdog process.</p><h2 class="markdown-heading" id="Watchdog-state">Watchdog state <a class="hover-link" href="#Watchdog-state">#</a></h2><p>Most LSP clients only send us file diffs, so to facilitate sending entire file contents to freshly restarted
workers, the watchdog needs to maintain the current state of each file. It can also use this state to detect changes
to the header and thus restart the corresponding worker, freeing its imports.</p><p>TODO(WN):
We may eventually want to keep track of approximately (since this isn't knowable exactly) where in the file a worker
crashed. Then on restart, we tell said worker to only parse up to that point and query the user about how to proceed
(continue OR allow the user to fix the bug and then continue OR ..). Without this, if the crash is deterministic,
users may be confused about why the server seemingly stopped working for a single file.</p><h2 class="markdown-heading" id="Watchdog-<->-worker-communication">Watchdog <-> worker communication <a class="hover-link" href="#Watchdog-<->-worker-communication">#</a></h2><p>The watchdog process and its file worker processes communicate via LSP. If the necessity arises,
we might add non-standard commands similarly based on JSON-RPC. Most requests and notifications
are forwarded to the corresponding file worker process, with the exception of these notifications:</p><ul>
<li>textDocument/didOpen: Launch the file worker, create the associated watchdog state and launch a task to
asynchronously receive LSP packets from the worker (e.g. request responses).</li>
<li>textDocument/didChange: Update the local file state so that it can be resent to restarted workers.
Then forward the <code>didChange</code> notification.</li>
<li>textDocument/didClose: Signal a shutdown to the file worker and remove the associated watchdog state.</li>
</ul><p>Moreover, we don't implement the full protocol at this level:</p><ul>
<li>Upon starting, the <code>initialize</code> request is forwarded to the worker, but it must not respond with its server
capabilities. Consequently, the watchdog will not send an <code>initialized</code> notification to the worker.</li>
<li>After <code>initialize</code>, the watchdog sends the corresponding <code>didOpen</code> notification with the full current state of
the file. No additional <code>didOpen</code> notifications will be forwarded to the worker process.</li>
<li><code>$/cancelRequest</code> notifications are forwarded to all file workers.</li>
<li>File workers are always terminated with an <code>exit</code> notification, without previously receiving a <code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.shutdown">shutdown</a></code> request.
Similarly, they never receive a <code>didClose</code> notification.</li>
</ul><h2 class="markdown-heading" id="Watchdog-<->-client-communication">Watchdog <-> client communication <a class="hover-link" href="#Watchdog-<->-client-communication">#</a></h2><p>The watchdog itself should implement the LSP standard as closely as possible. However we reserve the right to add
non-standard extensions in case they're needed, for example to communicate tactic state.</p></div><div class="decl" id="Lean.Server.Watchdog.workerCfg"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L71-L76">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.workerCfg"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">workerCfg</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/System/IO.html#IO.Process.StdioConfig">IO.Process.StdioConfig</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.workerCfg">Lean.Server.Watchdog.workerCfg</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">stdin</span> := <a href="../.././Init/System/IO.html#IO.Process.Stdio.piped">IO.Process.Stdio.piped</a>, <span class="fn">stdout</span> := <a href="../.././Init/System/IO.html#IO.Process.Stdio.piped">IO.Process.Stdio.piped</a>, <span class="fn">stderr</span> := <a href="../.././Init/System/IO.html#IO.Process.Stdio.inherit">IO.Process.Stdio.inherit</a> }</span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.WorkerEvent"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L79-L83">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">WorkerEvent</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="constructors"><li class="constructor" id="Lean.Server.Watchdog.WorkerEvent.terminated">terminated: <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a></li><li class="constructor" id="Lean.Server.Watchdog.WorkerEvent.importsChanged">importsChanged: <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a></li><li class="constructor" id="Lean.Server.Watchdog.WorkerEvent.crashed">crashed: <span class="fn"><a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a></span></li><li class="constructor" id="Lean.Server.Watchdog.WorkerEvent.ioError">ioError: <span class="fn"><a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a></span></li></ul><p>Events that worker-specific tasks signal to the main thread.</p><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Server.Watchdog.WorkerEvent" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.WorkerState"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L85-L94">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">WorkerState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="constructors"><li class="constructor" id="Lean.Server.Watchdog.WorkerState.crashed"><div class="inductive_ctor_doc"><p>The watchdog can detect a crashed file worker in two places: When trying to send a message to the file worker
and when reading a request reply.
In the latter case, the forwarding task terminates and delegates a <code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent.crashed">crashed</a></code> event to the main task.
Then, in both cases, the file worker has its state set to <code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent.crashed">crashed</a></code> and requests that are in-flight are errored.
Upon receiving the next packet for that file worker, the file worker is restarted and the packet is forwarded
to it. If the crash was detected while writing a packet, we queue that packet until the next packet for the file
worker arrives.</p></div>crashed: <span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a></span> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerState">Lean.Server.Watchdog.WorkerState</a></span></li><li class="constructor" id="Lean.Server.Watchdog.WorkerState.running">running: <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerState">Lean.Server.Watchdog.WorkerState</a></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Server.Watchdog.WorkerState" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.PendingRequestMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L96-L96">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.PendingRequestMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">PendingRequestMap</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.PendingRequestMap">Lean.Server.Watchdog.PendingRequestMap</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">Lean.RBMap</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a> <span class="fn">compare</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L100-L110">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.Watchdog.FileWorker.mk"><li id="Lean.Server.Watchdog.FileWorker.doc" class="structure_field"><div class="structure_field_info">doc : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">Lean.Server.DocumentMeta</a></div></li><li id="Lean.Server.Watchdog.FileWorker.proc" class="structure_field"><div class="structure_field_info">proc : <span class="fn"><a href="../.././Init/System/IO.html#IO.Process.Child">IO.Process.Child</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.workerCfg">Lean.Server.Watchdog.workerCfg</a></span></div></li><li id="Lean.Server.Watchdog.FileWorker.commTask" class="structure_field"><div class="structure_field_info">commTask : <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a></span></div></li><li id="Lean.Server.Watchdog.FileWorker.state" class="structure_field"><div class="structure_field_info">state : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerState">Lean.Server.Watchdog.WorkerState</a></div></li><li id="Lean.Server.Watchdog.FileWorker.pendingRequestsRef" class="structure_field"><div class="structure_field_doc"><p>The pending requests map contains all requests
that have been received from the LSP client, but were not answered yet.
We need them for forwaring cancellation requests to the correct worker as well as cleanly aborting
requests on worker crashes.</p></div><div class="structure_field_info">pendingRequestsRef : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.PendingRequestMap">Lean.Server.Watchdog.PendingRequestMap</a></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Server.Watchdog.FileWorker" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.stdin"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L114-L115">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.stdin"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">stdin</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.stdin">Lean.Server.Watchdog.FileWorker.stdin</a> <span class="fn">fw</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/System/IO.html#IO.FS.Stream.ofHandle">IO.FS.Stream.ofHandle</a> <span class="fn"><span class="fn"><span class="fn">fw</span>.proc</span>.stdin</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.stdout"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L117-L118">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.stdout"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">stdout</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.stdout">Lean.Server.Watchdog.FileWorker.stdout</a> <span class="fn">fw</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/System/IO.html#IO.FS.Stream.ofHandle">IO.FS.Stream.ofHandle</a> <span class="fn"><span class="fn"><span class="fn">fw</span>.proc</span>.stdout</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.erasePendingRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L120-L121">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.erasePendingRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">erasePendingRequest</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.erasePendingRequest">Lean.Server.Watchdog.FileWorker.erasePendingRequest</a> <span class="fn">fw</span> <span class="fn">id</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Init/System/ST.html#ST.Ref.modify">ST.Ref.modify</a> <span class="fn"><span class="fn">fw</span>.pendingRequestsRef</span> <span class="fn">fun <span class="fn">pendingRequests</span> =&gt <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap.erase">Lean.RBMap.erase</a> <span class="fn">pendingRequests</span> <span class="fn">id</span></span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorker.errorPendingRequests"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L123-L126">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker.errorPendingRequests"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorker</span>.<span class="name">errorPendingRequests</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args">
<span class="fn">(hError : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(code : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.ErrorCode">Lean.JsonRpc.ErrorCode</a>)</span></span>
<span class="decl_args">
<span class="fn">(msg : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.FileWorkerMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L132-L132">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorkerMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">FileWorkerMap</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorkerMap">Lean.Server.Watchdog.FileWorkerMap</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">Lean.RBMap</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a> <span class="fn">compare</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ServerContext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L134-L145">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerContext"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerContext</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.Watchdog.ServerContext.mk"><li id="Lean.Server.Watchdog.ServerContext.hIn" class="structure_field"><div class="structure_field_info">hIn : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.Watchdog.ServerContext.hOut" class="structure_field"><div class="structure_field_info">hOut : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.Watchdog.ServerContext.hLog" class="structure_field"><div class="structure_field_info">hLog : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.Watchdog.ServerContext.args" class="structure_field"><div class="structure_field_doc"><p>Command line arguments.</p></div><div class="structure_field_info">args : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span></div></li><li id="Lean.Server.Watchdog.ServerContext.fileWorkersRef" class="structure_field"><div class="structure_field_info">fileWorkersRef : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorkerMap">Lean.Server.Watchdog.FileWorkerMap</a></span></div></li><li id="Lean.Server.Watchdog.ServerContext.initParams" class="structure_field"><div class="structure_field_doc"><p>We store these to pass them to workers.</p></div><div class="structure_field_info">initParams : <a href="../.././Lean/Data/Lsp/InitShutdown.html#Lean.Lsp.InitializeParams">Lean.Lsp.InitializeParams</a></div></li><li id="Lean.Server.Watchdog.ServerContext.workerPath" class="structure_field"><div class="structure_field_info">workerPath : <a href="../.././Init/System/FilePath.html#System.FilePath">System.FilePath</a></div></li><li id="Lean.Server.Watchdog.ServerContext.srcSearchPath" class="structure_field"><div class="structure_field_info">srcSearchPath : <a href="../.././Init/System/FilePath.html#System.SearchPath">System.SearchPath</a></div></li><li id="Lean.Server.Watchdog.ServerContext.references" class="structure_field"><div class="structure_field_info">references : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/References.html#Lean.Server.References">Lean.Server.References</a></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Server.Watchdog.ServerContext" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ServerM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L147-L147">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerM</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerContext">Lean.Server.Watchdog.ServerContext</a> <a href="../.././Init/System/IO.html#IO">IO</a></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.updateFileWorkers"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L149-L150">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.updateFileWorkers"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">updateFileWorkers</span></a></span><span class="decl_args">
<span class="fn">(val : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.updateFileWorkers">Lean.Server.Watchdog.updateFileWorkers</a> <span class="fn">val</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">read</span>
  <span class="fn"><a href="../.././Init/System/ST.html#ST.Ref.modify">ST.Ref.modify</a> <span class="fn"><span class="fn">__do_lift</span>.fileWorkersRef</span> <span class="fn">fun <span class="fn">fileWorkers</span> =&gt <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap.insert">Lean.RBMap.insert</a> <span class="fn">fileWorkers</span> <span class="fn"><span class="fn"><span class="fn">val</span>.doc</span>.uri</span> <span class="fn">val</span></span></span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.findFileWorker?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L152-L153">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.findFileWorker?"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findFileWorker?</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.findFileWorker?">Lean.Server.Watchdog.findFileWorker?</a> <span class="fn">uri</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let __do_lift ← <span class="fn">read</span>
  let __do_lift ← <span class="fn"><a href="../.././Init/System/ST.html#ST.Ref.get">ST.Ref.get</a> <span class="fn"><span class="fn">__do_lift</span>.fileWorkersRef</span></span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> (<span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap.find?">Lean.RBMap.find?</a> <span class="fn">__do_lift</span> <span class="fn">uri</span></span>)</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.findFileWorker!"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L155-L158">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.findFileWorker!"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findFileWorker!</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.eraseFileWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L160-L165">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.eraseFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">eraseFileWorker</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.log"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L167-L170">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.log"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">log</span></a></span><span class="decl_args">
<span class="fn">(msg : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.log">Lean.Server.Watchdog.log</a> <span class="fn">msg</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let st ← <span class="fn">read</span>
  <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> (<span class="fn"><a href="../.././Init/System/IO.html#IO.FS.Stream.putStrLn">IO.FS.Stream.putStrLn</a> <span class="fn"><span class="fn">st</span>.hLog</span> <span class="fn">msg</span></span>)</span>
  <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn"><span class="fn"><span class="fn">st</span>.hLog</span>.flush</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleIleanInfoUpdate"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L172-L176">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleIleanInfoUpdate"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleIleanInfoUpdate</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Lsp/Internal.html#Lean.Lsp.LeanIleanInfoParams">Lean.Lsp.LeanIleanInfoParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleIleanInfoFinal"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L178-L182">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleIleanInfoFinal"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleIleanInfoFinal</span></a></span><span class="decl_args">
<span class="fn">(fw : <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Lsp/Internal.html#Lean.Lsp.LeanIleanInfoParams">Lean.Lsp.LeanIleanInfoParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.startFileWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L237-L268">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.startFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">startFileWorker</span></a></span><span class="decl_args">
<span class="fn">(m : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">Lean.Server.DocumentMeta</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.terminateFileWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L270-L282">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.terminateFileWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">terminateFileWorker</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleCrash"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L284-L285">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleCrash"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCrash</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args">
<span class="fn">(queuedMsgs : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.tryWriteMessage"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L292-L327">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.tryWriteMessage"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">tryWriteMessage</span></a></span><span class="decl_args">
<span class="fn">(uri : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.DocumentUri">Lean.Lsp.DocumentUri</a>)</span></span>
<span class="decl_args">
<span class="fn">(msg : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a>)</span></span>
<span class="decl_args">
<span class="fn">(queueFailedMessage : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <a href="../.././Init/Prelude.html#Bool">Bool</a> <a href="../.././Init/Prelude.html#Bool.true">true</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(restartCrashedWorker : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <a href="../.././Init/Prelude.html#Bool">Bool</a> <a href="../.././Init/Prelude.html#Bool.false">false</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Tries to write a message, sets the state of the FileWorker to <code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent.crashed">crashed</a></code> if it does not succeed
and restarts the file worker if the <code><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent.crashed">crashed</a></code> flag was already set. Just logs an error if there
is no FileWorker at this <code>uri</code>.
Messages that couldn't be sent can be queued up via the queueFailedMessage flag and
will be discharged after the FileWorker is restarted.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.findDefinitions"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L334-L343">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.findDefinitions"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findDefinitions</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.TextDocumentPositionParams">Lean.Lsp.TextDocumentPositionParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.Location">Lean.Lsp.Location</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleReference"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L345-L354">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleReference"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleReference</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.ReferenceParams">Lean.Lsp.ReferenceParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.Location">Lean.Lsp.Location</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleWorkspaceSymbol"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L356-L372">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleWorkspaceSymbol"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleWorkspaceSymbol</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.WorkspaceSymbolParams">Lean.Lsp.WorkspaceSymbolParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> (<span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.SymbolInformation">Lean.Lsp.SymbolInformation</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleDidOpen"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L377-L384">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidOpen"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidOpen</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/TextSync.html#Lean.Lsp.DidOpenTextDocumentParams">Lean.Lsp.DidOpenTextDocumentParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidOpen">Lean.Server.Watchdog.handleDidOpen</a> <span class="fn">p</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">let doc := <span class="fn"><span class="fn">p</span>.textDocument</span>;
  <span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.startFileWorker">Lean.Server.Watchdog.startFileWorker</a> <span class="fn">{ <span class="fn">uri</span> := <span class="fn"><span class="fn">doc</span>.uri</span>, <span class="fn">version</span> := <span class="fn"><span class="fn">doc</span>.version</span>, <span class="fn">text</span> := <span class="fn"><a href="../.././Lean/Data/Position.html#String.toFileMap">String.toFileMap</a> <span class="fn"><span class="fn">doc</span>.text</span></span> }</span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleDidChange"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L386-L397">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidChange"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidChange</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/TextSync.html#Lean.Lsp.DidChangeTextDocumentParams">Lean.Lsp.DidChangeTextDocumentParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleDidClose"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L399-L400">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidClose"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidClose</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/TextSync.html#Lean.Lsp.DidCloseTextDocumentParams">Lean.Lsp.DidCloseTextDocumentParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidClose">Lean.Server.Watchdog.handleDidClose</a> <span class="fn">p</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.terminateFileWorker">Lean.Server.Watchdog.terminateFileWorker</a> <span class="fn"><span class="fn"><span class="fn">p</span>.textDocument</span>.uri</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleDidChangeWatchedFiles"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L402-L420">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleDidChangeWatchedFiles"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleDidChangeWatchedFiles</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/Workspace.html#Lean.Lsp.DidChangeWatchedFilesParams">Lean.Lsp.DidChangeWatchedFilesParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleCancelRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L422-L428">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleCancelRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleCancelRequest</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.CancelParams">Lean.Lsp.CancelParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.forwardNotification"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L430-L431">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.forwardNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">forwardNotification</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.ToJson">Lean.ToJson</a> <span class="fn">α</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href="../.././Lean/Server/FileSource.html#Lean.Lsp.FileSource">Lean.Lsp.FileSource</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.parseParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L435-L438">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.parseParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">parseParams</span></a></span><span class="decl_args">
<span class="fn">(paramType : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">Lean.FromJson</a> <span class="fn">paramType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <span class="fn">paramType</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.forwardRequestToWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L440-L465">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.forwardRequestToWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">forwardRequestToWorker</span></a></span><span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L467-L495">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleRequest</span></a></span><span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.handleNotification"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L497-L510">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.handleNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">handleNotification</span></a></span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.shutdown"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L514-L519">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.shutdown"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">shutdown</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.ServerEvent"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L521-L524">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">ServerEvent</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="constructors"><li class="constructor" id="Lean.Server.Watchdog.ServerEvent.workerEvent">workerEvent: <span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.FileWorker">Lean.Server.Watchdog.FileWorker</a> → <span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.WorkerEvent">Lean.Server.Watchdog.WorkerEvent</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent">Lean.Server.Watchdog.ServerEvent</a></span></span></li><li class="constructor" id="Lean.Server.Watchdog.ServerEvent.clientMsg">clientMsg: <span class="fn"><a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">Lean.JsonRpc.Message</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent">Lean.Server.Watchdog.ServerEvent</a></span></li><li class="constructor" id="Lean.Server.Watchdog.ServerEvent.clientError">clientError: <span class="fn"><a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> → <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent">Lean.Server.Watchdog.ServerEvent</a></span></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Server.Watchdog.ServerEvent" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.runClientTask"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L526-L535">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.runClientTask"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">runClientTask</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> (<span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent">Lean.Server.Watchdog.ServerEvent</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.mainLoop"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L537-L576">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.mainLoop"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">mainLoop</span></a></span><span class="decl_args">
<span class="fn">(clientTask : <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerEvent">Lean.Server.Watchdog.ServerEvent</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.Server.Watchdog.mkLeanServerCapabilities"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L579-L612">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.mkLeanServerCapabilities"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">mkLeanServerCapabilities</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Data/Lsp/Capabilities.html#Lean.Lsp.ServerCapabilities">Lean.Lsp.ServerCapabilities</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.initAndRunWatchdogAux"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L614-L628">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.initAndRunWatchdogAux"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">initAndRunWatchdogAux</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.ServerM">Lean.Server.Watchdog.ServerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.findWorkerPath"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L630-L636">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.findWorkerPath"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">findWorkerPath</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/System/FilePath.html#System.FilePath">System.FilePath</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.loadReferences"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L638-L649">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.loadReferences"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">loadReferences</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Lean/Server/References.html#Lean.Server.References">Lean.Server.References</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.initAndRunWatchdog"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L651-L695">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.initAndRunWatchdog"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">initAndRunWatchdog</span></a></span><span class="decl_args">
<span class="fn">(args : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(i : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(o : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.Watchdog.watchdogMain"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/Watchdog.lean#L698-L707">source</a></div><div class="attributes">@[export lean_server_watchdog_main]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/Watchdog.html#Lean.Server.Watchdog.watchdogMain"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">Watchdog</span>.<span class="name">watchdogMain</span></a></span><span class="decl_args">
<span class="fn">(args : <span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#String">String</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#UInt32">UInt32</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>
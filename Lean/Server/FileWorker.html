<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="stylesheet" href="../.././src/pygments.css"></link><link rel="shortcut icon" href="../.././favicon.ico"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Server.FileWorker</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.Server.FileWorker";</script><script type="module" src="../.././search.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label>Documentation</h1><p class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span></p><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib4_docs"></input><input type="text" name="q" autocomplete="off"></input>&#32;
            <button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button><button>Google site search</button></form></header><nav class="internal_nav"><h3><a class="break_within" href="#top"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span></a></h3><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Init.html">Init</a></li><li><a href="../.././Lean/Environment.html">Lean.Environment</a></li><li><a href="../.././Lean/LoadDynlib.html">Lean.LoadDynlib</a></li><li><a href="../.././Init/System/IO.html">Init.System.IO</a></li><li><a href="../.././Lean/Data/Lsp.html">Lean.Data.Lsp</a></li><li><a href="../.././Lean/Data/RBMap.html">Lean.Data.RBMap</a></li><li><a href="../.././Lean/Server/AsyncList.html">Lean.Server.AsyncList</a></li><li><a href="../.././Lean/Server/References.html">Lean.Server.References</a></li><li><a href="../.././Lean/Server/Snapshots.html">Lean.Server.Snapshots</a></li><li><a href="../.././Lean/Server/Utils.html">Lean.Server.Utils</a></li><li><a href="../.././Lean/Util/Paths.html">Lean.Util.Paths</a></li><li><a href="../.././Lean/Widget/InteractiveDiagnostic.html">Lean.Widget.InteractiveDiagnostic</a></li><li><a href="../.././Lean/Data/Json/FromToJson.html">Lean.Data.Json.FromToJson</a></li><li><a href="../.././Lean/Server/FileWorker/RequestHandling.html">Lean.Server.FileWorker.RequestHandling</a></li><li><a href="../.././Lean/Server/FileWorker/Utils.html">Lean.Server.FileWorker.Utils</a></li><li><a href="../.././Lean/Server/FileWorker/WidgetRequests.html">Lean.Server.FileWorker.WidgetRequests</a></li><li><a href="../.././Lean/Server/Rpc/Basic.html">Lean.Server.Rpc.Basic</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Server.FileWorker" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerContext"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.AsyncElabState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">AsyncElabState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.AsyncElabM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">AsyncElabM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.unfoldCmdSnaps"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">unfoldCmdSnaps</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.PendingRequestMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">PendingRequestMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.lakeSetupSearchPath"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">lakeSetupSearchPath</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.lakeSetupSearchPath.processStderr"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">lakeSetupSearchPath</span>.<span class="name">processStderr</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.compileHeader"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">compileHeader</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.initializeWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initializeWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.updatePendingRequests"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">updatePendingRequests</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.updateDocument"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">updateDocument</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleDidChange"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleDidChange</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleCancelRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleCancelRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleRpcRelease"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcRelease</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleRpcKeepAlive"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcKeepAlive</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleRpcConnect"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcConnect</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.parseParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">parseParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleNotification</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.queueRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">queueRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.mainLoop"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">mainLoop</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.initAndRunWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initAndRunWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.workerMain"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">workerMain</span></a></div></nav><main>
<div class="mod_doc"><p>For general server architecture, see <code>README.md</code>. For details of IPC communication, see <code>Watchdog.lean</code>.
This module implements per-file worker processes.</p><p>File processing and requests+notifications against a file should be concurrent for two reasons:</p><ul>
<li>By the LSP standard, requests should be cancellable.</li>
<li>Since Lean allows arbitrary user code to be executed during elaboration via the tactic framework,
elaboration can be extremely slow and even not halt in some cases. Users should be able to
work with the file while this is happening, e.g. make new changes to the file or send requests.</li>
</ul><p>To achieve these goals, elaboration is executed in a chain of tasks, where each task corresponds to
the elaboration of one command. When the elaboration of one command is done, the next task is spawned.
On didChange notifications, we search for the task in which the change occured. If we stumble across
a task that has not yet finished before finding the task we're looking for, we terminate it
and start the elaboration there, otherwise we start the elaboration at the task where the change occured.</p><p>Requests iterate over tasks until they find the command that they need to answer the request.
In order to not block the main thread, this is done in a request task.
If a task that the request task waits for is terminated, a change occured somewhere before the
command that the request is looking for and the request sends a "content changed" error.</p></div><div class="decl" id="Lean.Server.FileWorker.WorkerContext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L58-L64">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.FileWorker.WorkerContext.mk"><li id="Lean.Server.FileWorker.WorkerContext.hIn" class="structure_field"><div class="structure_field_info">hIn : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.FileWorker.WorkerContext.hOut" class="structure_field"><div class="structure_field_info">hOut : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.FileWorker.WorkerContext.hLog" class="structure_field"><div class="structure_field_info">hLog : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.FileWorker.WorkerContext.headerTask" class="structure_field"><div class="structure_field_info">headerTask : <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> (<span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> (<span class="fn"><a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Util/Path.html#Lean.SearchPath">Lean.SearchPath</a></span>)</span>)</span></div></li><li id="Lean.Server.FileWorker.WorkerContext.initParams" class="structure_field"><div class="structure_field_info">initParams : <a href="../.././Lean/Data/Lsp/InitShutdown.html#Lean.Lsp.InitializeParams">Lean.Lsp.InitializeParams</a></div></li><li id="Lean.Server.FileWorker.WorkerContext.clientHasWidgets" class="structure_field"><div class="structure_field_info">clientHasWidgets : <a href="../.././Init/Prelude.html#Bool">Bool</a></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Server.FileWorker.WorkerContext" class="instances-for-list"></ul></details></div></div><div class="mod_doc"><h1 class="markdown-heading" id="Asynchronous-snapshot-elaboration">Asynchronous snapshot elaboration <a class="hover-link" href="#Asynchronous-snapshot-elaboration">#</a></h1></div><div class="decl" id="Lean.Server.FileWorker.AsyncElabState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L69-L70">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.AsyncElabState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">AsyncElabState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.FileWorker.AsyncElabState.mk"><li id="Lean.Server.FileWorker.AsyncElabState.snaps" class="structure_field"><div class="structure_field_info">snaps : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Server.FileWorker.AsyncElabState" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.AsyncElabM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L72-L72">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.AsyncElabM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">AsyncElabM</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.AsyncElabM">Lean.Server.FileWorker.AsyncElabM</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Init/Control/State.html#StateT">StateT</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.AsyncElabState">Lean.Server.FileWorker.AsyncElabState</a> (<span class="fn"><a href="../.././Init/System/IO.html#EIO">EIO</a> <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.ElabTaskError">Lean.Server.FileWorker.ElabTaskError</a></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.unfoldCmdSnaps"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L123-L139">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.unfoldCmdSnaps"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">unfoldCmdSnaps</span></a></span><span class="decl_args">
<span class="fn">(m : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">Lean.Server.DocumentMeta</a>)</span></span>
<span class="decl_args">
<span class="fn">(snaps : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(cancelTk : <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.CancelToken">Lean.Server.FileWorker.CancelToken</a>)</span></span>
<span class="decl_args">
<span class="fn">(startAfterMs : <a href="../.././Init/Prelude.html#UInt32">UInt32</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">Lean.Server.FileWorker.WorkerContext</a> <a href="../.././Init/System/IO.html#IO">IO</a>
  (<span class="fn"><a href="../.././Lean/Server/AsyncList.html#IO.AsyncList">IO.AsyncList</a> <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.ElabTaskError">Lean.Server.FileWorker.ElabTaskError</a> <a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a></span>)</span></div></div><p>Elaborates all commands after the last snap (at least the header snap is assumed to exist), emitting the diagnostics into <code><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext.hOut">hOut</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.PendingRequestMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L143-L143">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">PendingRequestMap</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap">Lean.Server.FileWorker.PendingRequestMap</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">Lean.RBMap</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a> (<span class="fn"><a href="../.././Init/Core.html#Task">Task</a> (<span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span>)</span>) <span class="fn">compare</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.WorkerState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L145-L152">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.FileWorker.WorkerState.mk"><li id="Lean.Server.FileWorker.WorkerState.doc" class="structure_field"><div class="structure_field_info">doc : <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.EditableDocument">Lean.Server.FileWorker.EditableDocument</a></div></li><li id="Lean.Server.FileWorker.WorkerState.initHeaderStx" class="structure_field"><div class="structure_field_info">initHeaderStx : <a href="../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a></div></li><li id="Lean.Server.FileWorker.WorkerState.pendingRequests" class="structure_field"><div class="structure_field_info">pendingRequests : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap">Lean.Server.FileWorker.PendingRequestMap</a></div></li><li id="Lean.Server.FileWorker.WorkerState.rpcSessions" class="structure_field"><div class="structure_field_doc"><p>A map of RPC session IDs. We allow asynchronous elab tasks and request handlers
to modify sessions. A single <code>Ref</code> ensures atomic transactions.</p></div><div class="structure_field_info">rpcSessions : <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">Lean.RBMap</a> <a href="../.././Init/Prelude.html#UInt64">UInt64</a> (<span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.RpcSession">Lean.Server.FileWorker.RpcSession</a></span>) <span class="fn">compare</span></span></div></li></ul><details class="instances"><summary>Instances For</summary><ul id="instances-for-list-Lean.Server.FileWorker.WorkerState" class="instances-for-list"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.WorkerM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L154-L154">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerM</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">Lean.Server.FileWorker.WorkerContext</a> (<span class="fn"><a href="../.././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href="../.././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerState">Lean.Server.FileWorker.WorkerState</a> <a href="../.././Init/System/IO.html#IO">IO</a></span>)</span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.lakeSetupSearchPath"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L161-L190">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.lakeSetupSearchPath"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">lakeSetupSearchPath</span></a></span><span class="decl_args">
<span class="fn">(lakePath : <a href="../.././Init/System/FilePath.html#System.FilePath">System.FilePath</a>)</span></span>
<span class="decl_args">
<span class="fn">(m : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">Lean.Server.DocumentMeta</a>)</span></span>
<span class="decl_args">
<span class="fn">(imports : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Environment.html#Lean.Import">Lean.Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(hOut : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Lean/Util/Path.html#Lean.SearchPath">Lean.SearchPath</a></span></div></div><p>Use <code>lake print-paths</code> to compile dependencies on the fly and add them to <code>LEAN_PATH</code>.
Compilation progress is reported to <code><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext.hOut">hOut</a></code> via LSP notifications. Return the search path for
source files.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.lakeSetupSearchPath.processStderr"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L172-L178">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.lakeSetupSearchPath.processStderr"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">lakeSetupSearchPath</span>.<span class="name">processStderr</span></a></span><span class="decl_args">
<span class="fn">(lakePath : <a href="../.././Init/System/FilePath.html#System.FilePath">System.FilePath</a>)</span></span>
<span class="decl_args">
<span class="fn">(m : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">Lean.Server.DocumentMeta</a>)</span></span>
<span class="decl_args">
<span class="fn">(hOut : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(args : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Init/Prelude.html#String">String</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(lakeProc : <span class="fn"><a href="../.././Init/System/IO.html#IO.Process.Child">IO.Process.Child</a>
  <span class="fn"><span class="fn">{
      <span class="fn">toStdioConfig</span> :=
        <span class="fn">{ <span class="fn">stdin</span> := <a href="../.././Init/System/IO.html#IO.Process.Stdio.null">IO.Process.Stdio.null</a>, <span class="fn">stdout</span> := <a href="../.././Init/System/IO.html#IO.Process.Stdio.piped">IO.Process.Stdio.piped</a>, <span class="fn">stderr</span> := <a href="../.././Init/System/IO.html#IO.Process.Stdio.piped">IO.Process.Stdio.piped</a> }</span>,
      <span class="fn">cmd</span> := <span class="fn"><span class="fn">lakePath</span>.toString</span>, <span class="fn">args</span> := <span class="fn">args</span>, <span class="fn">cwd</span> := <span class="fn">none</span>, <span class="fn">env</span> := <span class="fn">#[]</span> }</span>.toStdioConfig</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(acc : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#String">String</a></span></div></div></div></div><div class="decl" id="Lean.Server.FileWorker.compileHeader"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L192-L247">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.compileHeader"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">compileHeader</span></a></span><span class="decl_args">
<span class="fn">(m : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">Lean.Server.DocumentMeta</a>)</span></span>
<span class="decl_args">
<span class="fn">(hOut : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href="../.././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(hasWidgets : <a href="../.././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href="../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> (<span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> (<span class="fn"><a href="../.././Lean/Server/Snapshots.html#Lean.Server.Snapshots.Snapshot">Lean.Server.Snapshots.Snapshot</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Util/Path.html#Lean.SearchPath">Lean.SearchPath</a></span>)</span>)</span></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.initializeWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L249-L271">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.initializeWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initializeWorker</span></a></span><span class="decl_args">
<span class="fn">(meta : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">Lean.Server.DocumentMeta</a>)</span></span>
<span class="decl_args">
<span class="fn">(i : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(o : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(initParams : <a href="../.././Lean/Data/Lsp/InitShutdown.html#Lean.Lsp.InitializeParams">Lean.Lsp.InitializeParams</a>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href="../.././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> (<span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">Lean.Server.FileWorker.WorkerContext</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerState">Lean.Server.FileWorker.WorkerState</a></span>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.updatePendingRequests"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L275-L276">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.updatePendingRequests"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">updatePendingRequests</span></a></span><span class="decl_args">
<span class="fn">(map : <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap">Lean.Server.FileWorker.PendingRequestMap</a> → <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap">Lean.Server.FileWorker.PendingRequestMap</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.updateDocument"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L279-L323">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.updateDocument"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">updateDocument</span></a></span><span class="decl_args">
<span class="fn">(newMeta : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">Lean.Server.DocumentMeta</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Given the new document, updates editable doc state.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleDidChange"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L329-L336">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleDidChange"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleDidChange</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/TextSync.html#Lean.Lsp.DidChangeTextDocumentParams">Lean.Lsp.DidChangeTextDocumentParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleCancelRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L338-L339">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleCancelRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleCancelRequest</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/Basic.html#Lean.Lsp.CancelParams">Lean.Lsp.CancelParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleCancelRequest">Lean.Server.FileWorker.handleCancelRequest</a> <span class="fn">p</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.updatePendingRequests">Lean.Server.FileWorker.updatePendingRequests</a> <span class="fn">fun <span class="fn">pendingRequests</span> =&gt <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap.erase">Lean.RBMap.erase</a> <span class="fn">pendingRequests</span> <span class="fn"><span class="fn">p</span>.id</span></span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleRpcRelease"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L341-L352">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleRpcRelease"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcRelease</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/Extra.html#Lean.Lsp.RpcReleaseParams">Lean.Lsp.RpcReleaseParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleRpcKeepAlive"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L354-L358">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleRpcKeepAlive"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcKeepAlive</span></a></span><span class="decl_args">
<span class="fn">(p : <a href="../.././Lean/Data/Lsp/Extra.html#Lean.Lsp.RpcKeepAliveParams">Lean.Lsp.RpcKeepAliveParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="mod_doc"><p>Requests here are handled synchronously rather than in the asynchronous <code>RequestM</code>.</p></div><div class="decl" id="Lean.Server.FileWorker.handleRpcConnect"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L365-L369">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleRpcConnect"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcConnect</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Lsp/Extra.html#Lean.Lsp.RpcConnectParams">Lean.Lsp.RpcConnectParams</a> → <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Lean/Data/Lsp/Extra.html#Lean.Lsp.RpcConnected">Lean.Lsp.RpcConnected</a></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.parseParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L374-L377">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.parseParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">parseParams</span></a></span><span class="decl_args">
<span class="fn">(paramType : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[inst : <span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">Lean.FromJson</a> <span class="fn">paramType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <span class="fn">paramType</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleNotification"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L379-L387">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleNotification</span></a></span><span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.queueRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L389-L391">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.queueRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">queueRequest</span></a></span><span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(requestTask : <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> (<span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span>)</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.queueRequest">Lean.Server.FileWorker.queueRequest</a> <span class="fn">id</span> <span class="fn">requestTask</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.updatePendingRequests">Lean.Server.FileWorker.updatePendingRequests</a> <span class="fn">fun <span class="fn">pendingRequests</span> =&gt <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap.insert">Lean.RBMap.insert</a> <span class="fn">pendingRequests</span> <span class="fn">id</span> <span class="fn">requestTask</span></span></span></span></span></li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L393-L430">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRequest</span></a></span><span class="decl_args">
<span class="fn">(id : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(method : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(params : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.mainLoop"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L434-L468">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.mainLoop"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">mainLoop</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.Server.FileWorker.initAndRunWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L471-L492">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.initAndRunWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initAndRunWorker</span></a></span><span class="decl_args">
<span class="fn">(i : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(o : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(opts : <a href="../.././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#UInt32">UInt32</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.workerMain"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/ebc32af2e606deef0d7b437e67f24c20ed866818/src/Lean/Server/FileWorker.lean#L495-L508">source</a></div><div class="attributes">@[export lean_server_worker_main]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.workerMain"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">workerMain</span></a></span><span class="decl_args">
<span class="fn">(opts : <a href="../.././Lean/Data/Options.html#Lean.Options">Lean.Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#UInt32">UInt32</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>
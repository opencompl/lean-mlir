{"name":"Lean.Compiler.IR.ExpandResetReuse","instances":[],"imports":["Init","Lean.Compiler.IR.CompilerM","Lean.Compiler.IR.NormIds","Lean.Compiler.IR.FreeVars"],"declarations":[{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L277-L278","name":"Lean.IR.Decl.expandResetReuse","line":277,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.Decl.expandResetReuse","doc":"(Try to) expand `reset` and `reuse` instructions. "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.Decl.expandResetReuse\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">Decl</span>.<span class=\"name\">expandResetReuse</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(d : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.Decl\">Lean.IR.Decl</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.Decl\">Lean.IR.Decl</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L265-L272","name":"Lean.IR.ExpandResetReuse.main","line":265,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.main","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.main\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">main</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(d : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.Decl\">Lean.IR.Decl</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.Decl\">Lean.IR.Decl</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L249-L263","name":"Lean.IR.ExpandResetReuse.searchAndExpand","line":249,"kind":"opaque","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.searchAndExpand","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.searchAndExpand\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">searchAndExpand</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a> → <span class=\"fn\"><span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span> → <span class=\"fn\"><a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.M\">Lean.IR.ExpandResetReuse.M</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span></span></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L236-L247","name":"Lean.IR.ExpandResetReuse.expand","line":236,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.expand","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.expand\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">expand</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(mainFn : <span class=\"fn\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a> → <span class=\"fn\"><span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span> → <span class=\"fn\"><a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.M\">Lean.IR.ExpandResetReuse.M</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span></span></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(bs : <span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(x : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(n : <a href=\"./Init/Prelude.html#Nat\">Nat</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(b : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.M\">Lean.IR.ExpandResetReuse.M</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L230-L233","name":"Lean.IR.ExpandResetReuse.mkFastPath","line":230,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.mkFastPath","doc":"replace\n```\nx := reset y; b\n```\nwith\n```\nlet f_i_1 := proj[i_1] y;\n...\nlet f_i_k := proj[i_k] y;\nb'\n```\nwhere `i_j`s are the field indexes\nthat the code did not touch immediately before the reset.\nThat is `mask[j] == none`.\n`b'` is `b` where `y` `dec x` is replaced with `del y`,\nand `z := reuse x ctor_i ws; F` is replaced with\n`set x i ws[i]` operations, and we replace `z` with `x` in `F`\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.mkFastPath\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">mkFastPath</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(x : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(mask : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Mask\">Lean.IR.ExpandResetReuse.Mask</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(b : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.M\">Lean.IR.ExpandResetReuse.M</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L188-L209","name":"Lean.IR.ExpandResetReuse.reuseToSet","line":188,"kind":"opaque","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.reuseToSet","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.reuseToSet\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">reuseToSet</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(ctx : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context\">Lean.IR.ExpandResetReuse.Context</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(x : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a> → <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L168-L186","name":"Lean.IR.ExpandResetReuse.removeSelfSet","line":168,"kind":"opaque","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.removeSelfSet","doc":"Remove unnecessary `set/uset/sset` operations "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.removeSelfSet\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">removeSelfSet</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(ctx : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context\">Lean.IR.ExpandResetReuse.Context</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a> → <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L162-L165","name":"Lean.IR.ExpandResetReuse.isSelfSSet","line":162,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.isSelfSSet","doc":"Given `sset x[n, i] := y`, return true iff `y := sproj[n, i] x` "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.isSelfSSet\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">isSelfSSet</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(ctx : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context\">Lean.IR.ExpandResetReuse.Context</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(x : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(n : <a href=\"./Init/Prelude.html#Nat\">Nat</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(i : <a href=\"./Init/Prelude.html#Nat\">Nat</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Init/Prelude.html#Bool\">Bool</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L156-L159","name":"Lean.IR.ExpandResetReuse.isSelfUSet","line":156,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.isSelfUSet","doc":"Given `uset x[i] := y`, return true iff `y := uproj[i] x` "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.isSelfUSet\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">isSelfUSet</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(ctx : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context\">Lean.IR.ExpandResetReuse.Context</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(x : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(i : <a href=\"./Init/Prelude.html#Nat\">Nat</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Init/Prelude.html#Bool\">Bool</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L147-L153","name":"Lean.IR.ExpandResetReuse.isSelfSet","line":147,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.isSelfSet","doc":"Given `set x[i] := y`, return true iff `y := proj[i] x` "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.isSelfSet\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">isSelfSet</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(ctx : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context\">Lean.IR.ExpandResetReuse.Context</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(x : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(i : <a href=\"./Init/Prelude.html#Nat\">Nat</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.Arg\">Lean.IR.Arg</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Init/Prelude.html#Bool\">Bool</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L143-L144","name":"Lean.IR.ExpandResetReuse.setFields","line":143,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.setFields","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.setFields\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">setFields</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(zs : <span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.Arg\">Lean.IR.Arg</a></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(b : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L135-L141","name":"Lean.IR.ExpandResetReuse.releaseUnreadFields","line":135,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.releaseUnreadFields","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.releaseUnreadFields\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">releaseUnreadFields</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(mask : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Mask\">Lean.IR.ExpandResetReuse.Mask</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(b : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.M\">Lean.IR.ExpandResetReuse.M</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L132-L133","name":"Lean.IR.ExpandResetReuse.mkFresh","line":132,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.mkFresh","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.mkFresh\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">mkFresh</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.M\">Lean.IR.ExpandResetReuse.M</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L131-L131","name":"Lean.IR.ExpandResetReuse.M","line":131,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.M","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.M\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">M</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(α : <a href=\"./foundational_types.html\">Type</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L124-L129","name":"Lean.IR.ExpandResetReuse.mkSlowPath","line":124,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.mkSlowPath","doc":"replace\n```\nx := reset y; b\n```\nwith\n```\ninc z_1; ...; inc z_i; dec y; b'\n```\nwhere `z_i`'s are the variables in `mask`,\nand `b'` is `b` where we removed `dec x` and replaced `reuse x ctor_i ...` with `ctor_i ...`.\n"},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.mkSlowPath\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">mkSlowPath</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(x : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(mask : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Mask\">Lean.IR.ExpandResetReuse.Mask</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(b : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L90-L110","name":"Lean.IR.ExpandResetReuse.reuseToCtor","line":90,"kind":"opaque","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.reuseToCtor","doc":"Replace `reuse x ctor ...` with `ctor ...`, and remoce `dec x` "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.reuseToCtor\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">reuseToCtor</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(x : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a> → <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L86-L87","name":"Lean.IR.ExpandResetReuse.eraseProjIncFor","line":86,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.eraseProjIncFor","doc":"Try to erase `inc` instructions on projections of `y` occurring in the tail of `bs`.\nReturn the updated `bs` and a bit mask specifying which `inc`s have been removed. "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.eraseProjIncFor\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">eraseProjIncFor</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(n : <a href=\"./Init/Prelude.html#Nat\">Nat</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(bs : <span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span> <a href=\"./Init/Prelude.html#Prod\">×</a> <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Mask\">Lean.IR.ExpandResetReuse.Mask</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L53-L82","name":"Lean.IR.ExpandResetReuse.eraseProjIncForAux","line":53,"kind":"opaque","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.eraseProjIncForAux","doc":"Auxiliary function for eraseProjIncFor "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.eraseProjIncForAux\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">eraseProjIncForAux</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(y : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(bs : <span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(mask : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Mask\">Lean.IR.ExpandResetReuse.Mask</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(keep : <span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a></span> <a href=\"./Init/Prelude.html#Prod\">×</a> <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Mask\">Lean.IR.ExpandResetReuse.Mask</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L50-L50","name":"Lean.IR.ExpandResetReuse.Mask","line":50,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Mask","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Mask\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">Mask</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L41-L48","name":"Lean.IR.ExpandResetReuse.consumed","line":41,"kind":"opaque","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.consumed","doc":"Return true iff `x` is consumed in all branches of the current block.\nHere consumption means the block contains a `dec x` or `reuse x ...`. "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.consumed\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">consumed</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(x : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a> → <a href=\"./Init/Prelude.html#Bool\">Bool</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L37-L37","name":"Lean.IR.ExpandResetReuse.Context.projMap","line":37,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context.projMap","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context.projMap\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">Context</span>.<span class=\"name\">projMap</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(self : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context\">Lean.IR.ExpandResetReuse.Context</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.ProjMap\">Lean.IR.ExpandResetReuse.ProjMap</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L36-L37","name":"Lean.IR.ExpandResetReuse.Context","line":36,"kind":"structure","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">structure</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">Context</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L31-L34","name":"Lean.IR.ExpandResetReuse.mkProjMap","line":31,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.mkProjMap","doc":"Create a mapping from variables to projections.\nThis function assumes variable ids have been normalized "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.mkProjMap\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">mkProjMap</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(d : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.Decl\">Lean.IR.Decl</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.ProjMap\">Lean.IR.ExpandResetReuse.ProjMap</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L22-L26","name":"Lean.IR.ExpandResetReuse.CollectProjMap.collectFnBody","line":22,"kind":"opaque","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.CollectProjMap.collectFnBody","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">partial def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.CollectProjMap.collectFnBody\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">CollectProjMap</span>.<span class=\"name\">collectFnBody</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.FnBody\">Lean.IR.FnBody</a> → <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.CollectProjMap.Collector\">Lean.IR.ExpandResetReuse.CollectProjMap.Collector</a></span></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L15-L20","name":"Lean.IR.ExpandResetReuse.CollectProjMap.collectVDecl","line":15,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.CollectProjMap.collectVDecl","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.CollectProjMap.collectVDecl\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">CollectProjMap</span>.<span class=\"name\">collectVDecl</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(x : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.VarId\">Lean.IR.VarId</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(v : <a href=\"./Lean/Compiler/IR/Basic.html#Lean.IR.Expr\">Lean.IR.Expr</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.CollectProjMap.Collector\">Lean.IR.ExpandResetReuse.CollectProjMap.Collector</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L14-L14","name":"Lean.IR.ExpandResetReuse.CollectProjMap.Collector","line":14,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.CollectProjMap.Collector","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.CollectProjMap.Collector\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">CollectProjMap</span>.<span class=\"name\">Collector</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L12-L12","name":"Lean.IR.ExpandResetReuse.ProjMap","line":12,"kind":"def","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.ProjMap","doc":"Mapping from variable to projections "},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.ProjMap\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">ProjMap</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>"},{"info":{"sourceLink":"https://github.com/leanprover/lean4/blob/ec941735c80dc54c53948e30c428905b6600f95a/src/Lean/Compiler/IR/ExpandResetReuse.lean#L1-L1","name":"Lean.IR.ExpandResetReuse.Context.mk","line":1,"kind":"ctor","docLink":"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context.mk","doc":""},"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context.mk\"><span class=\"name\">Lean</span>.<span class=\"name\">IR</span>.<span class=\"name\">ExpandResetReuse</span>.<span class=\"name\">Context</span>.<span class=\"name\">mk</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(projMap : <a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.ProjMap\">Lean.IR.ExpandResetReuse.ProjMap</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Compiler/IR/ExpandResetReuse.html#Lean.IR.ExpandResetReuse.Context\">Lean.IR.ExpandResetReuse.Context</a></div></div>"}]}